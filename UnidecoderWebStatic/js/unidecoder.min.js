var __awaiter=this&&this.__awaiter||function(n,t,i,r){return new(i||(i=Promise))(function(u,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?u(n.value):new i(function(t){t(n.value)}).then(o,s)}e((r=r.apply(n,t||[])).next())})};String.prototype.startsWith||(String.prototype.startsWith=function(n,t){return this.substr(!t||t<0?0:+t,n.length)===n});class CharDef{}class DisplayChar{}class BlockDef{}class BasicInformation{}class Decoder{constructor(){this.functionUrl="https://unidecoderfunctions.azurewebsites.net";this.getBasics=function(){return __awaiter(this,void 0,void 0,function*(){if(!this.basics){console.log("fetching basics");var n;try{n=yield fetch(this.functionUrl+"/api/GetBasicInfo")}catch(t){console.log("error: "+t);n=yield fetch(this.functionUrl+"/api/GetBasicInfo?v="+new Date)}this.basics=yield n.json();console.log("got the basics")}return this.basics})};this.convertChar=function(n,t){return{codepoint:n,hex:t.codepointHex,name:t.name,block:t.block,category:this.basics.categories[t.categoryId],isLatin:t.block.indexOf("Latin")>=0}};this.expandToChars=function(n){return __awaiter(this,void 0,void 0,function*(){if(console.log("Calling function ListCharacters to parse: "+n),!n)return[];yield this.getBasics();var t=yield this.fetchJson("/api/ListCharacters?text=",n);return t.map(n=>this.convertChar(n.codepoint,n))})};this.findChars=function(n){return __awaiter(this,void 0,void 0,function*(){if(console.log("Calling function FindCharacters to search for: "+n),!n)return[];yield this.getBasics();var t=yield this.fetchJson("/api/FindCharacters?search=",n);return t.map(n=>this.convertChar(n.codepoint,n))})};this.getBlockList=function(){return __awaiter(this,void 0,void 0,function*(){var t,n,i;yield this.getBasics();t=this.basics.blocks;n=[];for(i in t)n.push({index:i,name:t[i]});return n.sort(function(n,t){return n.name===t.name?0:n.name.indexOf("Latin")>=0?t.name.indexOf("Latin")>=0?n.name<t.name?-1:1:-1:t.name.indexOf("Latin")>=0?1:n.name<t.name?-1:1}),n})};this.getCategoryList=function(){return __awaiter(this,void 0,void 0,function*(){var n,t,i;yield this.getBasics();n=this.basics.categories;t=[];for(i in n)t.push({index:i,name:n[i]});return t})};this.findCharsByBlock=function(n){return __awaiter(this,void 0,void 0,function*(){yield this.getBasics();var t=yield this.fetchJson("/api/GetCharactersByType?block=",n);return t.map(n=>this.convertChar(n.codepoint,n))})};this.findCharsByCategory=function(n){return __awaiter(this,void 0,void 0,function*(){yield this.getBasics();var t=yield this.fetchJson("/api/GetCharactersByType?category=",n);return t.map(n=>this.convertChar(n.codepoint,n))})};this.getCharCount=function(){return __awaiter(this,void 0,void 0,function*(){var n=yield this.getBasics();return n.charCount})};this.fetchJson=function(n,t){return __awaiter(this,void 0,void 0,function*(){var i;try{i=yield fetch(this.functionUrl+n+encodeURIComponent(t))}catch(r){return console.log("error fetching json from: "+n+"; error: "+r),null}return yield i.json()})}}}(function(n){"use strict";var t=new Decoder;n.decoder=t})(window);